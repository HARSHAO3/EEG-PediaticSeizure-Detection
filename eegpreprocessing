import numpy as np
import pandas as pd
from scipy.signal import butter, filtfilt, iirnotch


FS = 256          # Sampling frequency
LOWCUT = 0.5
HIGHCUT = 40.0
NOTCH_FREQ = 50   # Powerline noise
ORDER = 4

INPUT_CSV = "base_data.csv"
OUTPUT_CSV = "eeg_data_cleaned.csv"


def bandpass_filter(data, low, high, fs, order=4):
    nyq = 0.5 * fs
    b, a = butter(order, [low/nyq, high/nyq], btype='band')
    return filtfilt(b, a, data, axis=0)

def notch_filter(data, freq, fs, Q=30):
    b, a = iirnotch(freq/(fs/2), Q)
    return filtfilt(b, a, data, axis=0)

df = pd.read_csv(INPUT_CSV)
time_col = df.iloc[:, -1]
eeg_data = df.iloc[:, :-1].values
channel_names = df.columns[:-1]

print("EEG shape:", eeg_data.shape)
print("Time samples:", len(time_col))


print("Applying band-pass filter...")
eeg_clean = bandpass_filter(eeg_data, LOWCUT, HIGHCUT, FS, ORDER)

print("Applying notch filter...")
eeg_clean = notch_filter(eeg_clean, NOTCH_FREQ, FS)
clean_df = pd.DataFrame(eeg_clean, columns=channel_names)
clean_df["Time"] = time_col.values

clean_df.to_csv(OUTPUT_CSV, index=False)

print("âœ… Cleaned EEG saved as:", OUTPUT_CSV)
